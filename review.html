<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rate & Review - NearNect</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    :root {
      --primary: #6c5ce7;
      --secondary: #E91E63;
      --success: #00b894;
      --warning: #fdcb6e;
      --danger: #e17055;
      --info: #74b9ff;
      --dark: #2d3436;
      --light: #ddd6fe;
      --bg: #f8f9fa;
      --text: #2d3436;
      --border: #e9ecef;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --radius: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, rgba(108,92,231,0.1), rgba(233,30,99,0.1));
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .header p {
      color: #6c757d;
      font-size: 1.1rem;
    }

    .service-card {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 30px;
      margin-bottom: 30px;
    }

    .service-header {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--border);
    }

    .service-avatar {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
    }

    .service-info h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .service-info p {
      color: #6c757d;
      margin-bottom: 10px;
    }

    .service-rating {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .current-rating {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stars-display {
      color: #ffc107;
      font-size: 1.1rem;
    }

    .review-count {
      color: #6c757d;
      font-size: 0.9rem;
    }

    .rating-section {
      margin-bottom: 30px;
    }

    .rating-section h3 {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--text);
    }

    .rating-input {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .star-rating {
      display: flex;
      gap: 5px;
      font-size: 2rem;
    }

    .star {
      cursor: pointer;
      color: #ddd;
      transition: all 0.2s ease;
    }

    .star:hover,
    .star.active {
      color: #ffc107;
      transform: scale(1.1);
    }

    .rating-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      font-size: 0.9rem;
      color: #6c757d;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-section h3 {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 15px;
      color: var(--text);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text);
    }

    .form-input {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(108,92,231,0.1);
    }

    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--primary);
    }

    .checkbox-group label {
      margin: 0;
      font-weight: 500;
    }

    .rating-categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .category-rating {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
    }

    .category-rating h4 {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--text);
    }

    .category-stars {
      display: flex;
      justify-content: center;
      gap: 3px;
      font-size: 1.2rem;
    }

    .category-star {
      cursor: pointer;
      color: #ddd;
      transition: all 0.2s ease;
    }

    .category-star:hover,
    .category-star.active {
      color: #ffc107;
    }

    .btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(108,92,231,0.4);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn.loading {
      pointer-events: none;
    }

    .btn.loading::after {
      content: '';
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .recent-reviews {
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 30px;
    }

    .review-item {
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
    }

    .review-item:last-child {
      border-bottom: none;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .reviewer-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .reviewer-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
    }

    .reviewer-name {
      font-weight: 600;
      color: var(--text);
    }

    .review-rating {
      color: #ffc107;
      font-size: 0.9rem;
    }

    .review-date {
      font-size: 0.8rem;
      color: #6c757d;
    }

    .review-text {
      color: #6c757d;
      line-height: 1.5;
      margin-bottom: 10px;
    }

    .review-helpful {
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 0.8rem;
      color: #6c757d;
    }

    .helpful-btn {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 0.8rem;
    }

    .helpful-btn:hover {
      text-decoration: underline;
    }

    /* Toast notifications */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: var(--shadow);
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.error {
      background: var(--danger);
    }

    .toast.warning {
      background: var(--warning);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }

      .service-header {
        flex-direction: column;
        text-align: center;
      }

      .rating-categories {
        grid-template-columns: 1fr;
      }

      .review-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }

    /* Animation for rating */
    .star {
      animation: starPulse 0.3s ease-in-out;
    }

    @keyframes starPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-star"></i> Rate & Review</h1>
      <p>Share your experience and help others make informed decisions</p>
    </div>

    <!-- Service Information -->
    <div class="service-card">
      <div class="service-header">
        <img src="https://images.unsplash.com/photo-1581091014534-3e89df7cf2a5?q=80&w=100&h=100&auto=format&fit=crop" alt="Service Provider" class="service-avatar">
        <div class="service-info">
          <h2>Ali Khan</h2>
          <p>Professional Plumber</p>
          <div class="service-rating">
            <span class="current-rating">4.8</span>
            <span class="stars-display">★★★★★</span>
            <span class="review-count">(150 reviews)</span>
          </div>
        </div>
      </div>

      <!-- Overall Rating -->
      <div class="rating-section">
        <h3>Overall Rating</h3>
        <div class="rating-input">
          <div class="star-rating" id="overallRating">
            <span class="star" data-rating="1">★</span>
            <span class="star" data-rating="2">★</span>
            <span class="star" data-rating="3">★</span>
            <span class="star" data-rating="4">★</span>
            <span class="star" data-rating="5">★</span>
          </div>
        </div>
        <div class="rating-labels">
          <span>Poor</span>
          <span>Excellent</span>
        </div>
      </div>

      <!-- Category Ratings -->
      <div class="rating-section">
        <h3>Rate by Category</h3>
        <div class="rating-categories">
          <div class="category-rating">
            <h4>Quality of Work</h4>
            <div class="category-stars" data-category="quality">
              <span class="category-star" data-rating="1">★</span>
              <span class="category-star" data-rating="2">★</span>
              <span class="category-star" data-rating="3">★</span>
              <span class="category-star" data-rating="4">★</span>
              <span class="category-star" data-rating="5">★</span>
            </div>
          </div>

          <div class="category-rating">
            <h4>Punctuality</h4>
            <div class="category-stars" data-category="punctuality">
              <span class="category-star" data-rating="1">★</span>
              <span class="category-star" data-rating="2">★</span>
              <span class="category-star" data-rating="3">★</span>
              <span class="category-star" data-rating="4">★</span>
              <span class="category-star" data-rating="5">★</span>
            </div>
          </div>

          <div class="category-rating">
            <h4>Communication</h4>
            <div class="category-stars" data-category="communication">
              <span class="category-star" data-rating="1">★</span>
              <span class="category-star" data-rating="2">★</span>
              <span class="category-star" data-rating="3">★</span>
              <span class="category-star" data-rating="4">★</span>
              <span class="category-star" data-rating="5">★</span>
            </div>
          </div>

          <div class="category-rating">
            <h4>Value for Money</h4>
            <div class="category-stars" data-category="value">
              <span class="category-star" data-rating="1">★</span>
              <span class="category-star" data-rating="2">★</span>
              <span class="category-star" data-rating="3">★</span>
              <span class="category-star" data-rating="4">★</span>
              <span class="category-star" data-rating="5">★</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Review Form -->
      <div class="form-section">
        <h3>Write Your Review</h3>
        
        <div class="form-group">
          <label for="reviewTitle">Review Title</label>
          <input type="text" id="reviewTitle" class="form-input" placeholder="Summarize your experience in a few words">
        </div>

        <div class="form-group">
          <label for="reviewText">Detailed Review</label>
          <textarea id="reviewText" class="form-input form-textarea" placeholder="Tell others about your experience. What went well? What could be improved?"></textarea>
        </div>

        <div class="form-group">
          <label for="recommendation">Would you recommend this service?</label>
          <div style="display: flex; gap: 20px; margin-top: 10px;">
            <div class="checkbox-group">
              <input type="radio" id="recommendYes" name="recommendation" value="yes">
              <label for="recommendYes">Yes, I would recommend</label>
            </div>
            <div class="checkbox-group">
              <input type="radio" id="recommendNo" name="recommendation" value="no">
              <label for="recommendNo">No, I would not recommend</label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="anonymousReview">
            <label for="anonymousReview">Submit this review anonymously</label>
          </div>
        </div>

        <button class="btn" id="submitReview" onclick="window.submitReview()">
          <i class="fas fa-paper-plane"></i>
          Submit Review
        </button>
      </div>
    </div>

    <!-- Recent Reviews -->
    <div class="recent-reviews">
      <h3 style="margin-bottom: 20px; font-weight: 700;">Recent Reviews</h3>
      
      <div class="review-item">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">JD</div>
            <div>
              <div class="reviewer-name">John Doe</div>
              <div class="review-rating">★★★★★</div>
            </div>
          </div>
          <div class="review-date">2 days ago</div>
        </div>
        <div class="review-text">
          "Excellent service! Ali fixed my kitchen faucet quickly and professionally. Very reasonable pricing and clean work. Highly recommended!"
        </div>
        <div class="review-helpful">
          <span>Was this review helpful?</span>
          <button class="helpful-btn">Yes (12)</button>
          <button class="helpful-btn">No (1)</button>
        </div>
      </div>

      <div class="review-item">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">SM</div>
            <div>
              <div class="reviewer-name">Sarah Miller</div>
              <div class="review-rating">★★★★☆</div>
            </div>
          </div>
          <div class="review-date">1 week ago</div>
        </div>
        <div class="review-text">
          "Good work overall, but took a bit longer than expected. The quality was decent and the price was fair."
        </div>
        <div class="review-helpful">
          <span>Was this review helpful?</span>
          <button class="helpful-btn">Yes (8)</button>
          <button class="helpful-btn">No (2)</button>
        </div>
      </div>

      <div class="review-item">
        <div class="review-header">
          <div class="reviewer-info">
            <div class="reviewer-avatar">RK</div>
            <div>
              <div class="reviewer-name">Rajesh Kumar</div>
              <div class="review-rating">★★★★★</div>
            </div>
          </div>
          <div class="review-date">2 weeks ago</div>
        </div>
        <div class="review-text">
          "Outstanding service! Ali is very professional and knows his work well. Will definitely book again for future plumbing needs."
        </div>
        <div class="review-helpful">
          <span>Was this review helpful?</span>
          <button class="helpful-btn">Yes (15)</button>
          <button class="helpful-btn">No (0)</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div id="toast" class="toast"></div>

  <script type="module">
    import { getApiBase, authHeaders, ensureDemoLogin } from './assets/js/api.js';
    
    class ReviewSystem {
      constructor() {
        this.overallRating = 0;
        this.categoryRatings = {
          quality: 0,
          punctuality: 0,
          communication: 0,
          value: 0
        };
        this.workerId = null;
        this.workerInfo = null;
        this.init();
      }

      async init() {
        await ensureDemoLogin();
        await this.loadWorkerInfo();
        this.setupStarRatings();
        await this.loadReviews();
      }

      async loadWorkerInfo() {
        // Get worker ID from URL params or localStorage
        const urlParams = new URLSearchParams(window.location.search);
        const workerId = urlParams.get('workerId') || urlParams.get('id');
        
        if (workerId) {
          this.workerId = workerId;
          try {
            const res = await fetch(`${getApiBase()}/workers/${workerId}`, { headers: { ...authHeaders() } });
            if (res.ok) {
              this.workerInfo = await res.json();
              this.updateWorkerDisplay();
            }
          } catch (e) {
            console.error('Failed to load worker info:', e);
          }
        } else {
          // Try to get from localStorage (selected worker)
          const selectedWorker = localStorage.getItem('nearnect_selected_worker');
          if (selectedWorker) {
            try {
              const worker = JSON.parse(selectedWorker);
              this.workerId = worker.id || worker._id;
              this.workerInfo = worker;
              this.updateWorkerDisplay();
            } catch (e) {
              console.error('Failed to parse selected worker:', e);
            }
          }
        }
      }

      updateWorkerDisplay() {
        if (!this.workerInfo) return;
        
        const avatarEl = document.querySelector('.service-avatar');
        const nameEl = document.querySelector('.service-info h2');
        const skillEl = document.querySelector('.service-info p');
        const ratingEl = document.querySelector('.current-rating');
        const reviewCountEl = document.querySelector('.review-count');
        
        if (avatarEl && this.workerInfo.avatarUrl) {
          avatarEl.src = this.workerInfo.avatarUrl;
        }
        if (nameEl) nameEl.textContent = this.workerInfo.name || 'Service Provider';
        if (skillEl) skillEl.textContent = this.workerInfo.skill || 'Professional Service';
        
        // Load reviews to calculate average rating
        this.loadReviews().then(() => {
          // Rating will be updated after reviews load
        });
      }

      setupStarRatings() {
        // Overall rating stars
        document.querySelectorAll('#overallRating .star').forEach(star => {
          star.addEventListener('click', () => {
            this.setOverallRating(parseInt(star.getAttribute('data-rating')));
          });
        });

        // Category rating stars
        document.querySelectorAll('.category-stars').forEach(categoryStars => {
          const category = categoryStars.getAttribute('data-category');
          categoryStars.querySelectorAll('.category-star').forEach(star => {
            star.addEventListener('click', () => {
              this.setCategoryRating(category, parseInt(star.getAttribute('data-rating')));
            });
          });
        });
      }

      setOverallRating(rating) {
        this.overallRating = rating;
        this.updateStarDisplay('#overallRating', rating);
      }

      setCategoryRating(category, rating) {
        this.categoryRatings[category] = rating;
        this.updateStarDisplay(`[data-category="${category}"]`, rating);
      }

      updateStarDisplay(selector, rating) {
        const stars = document.querySelectorAll(`${selector} .star`);
        stars.forEach((star, index) => {
          if (index < rating) {
            star.classList.add('active');
          } else {
            star.classList.remove('active');
          }
        });
      }

      async loadReviews() {
        if (!this.workerId) {
          this.displayReviews([]);
          return;
        }
        
        try {
          const res = await fetch(`${getApiBase()}/reviews/worker/${this.workerId}`, { headers: { ...authHeaders() } });
          if (res.ok) {
            const reviews = await res.json();
            this.displayReviews(reviews);
            this.updateWorkerRating(reviews);
          } else {
            this.displayReviews([]);
          }
        } catch (e) {
          console.error('Failed to load reviews:', e);
          this.displayReviews([]);
        }
      }

      updateWorkerRating(reviews) {
        if (!reviews || reviews.length === 0) return;
        
        const totalRating = reviews.reduce((sum, r) => sum + (r.rating || 0), 0);
        const avgRating = (totalRating / reviews.length).toFixed(1);
        const ratingEl = document.querySelector('.current-rating');
        const reviewCountEl = document.querySelector('.review-count');
        
        if (ratingEl) ratingEl.textContent = avgRating;
        if (reviewCountEl) reviewCountEl.textContent = `(${reviews.length} reviews)`;
        
        // Update stars display
        const starsEl = document.querySelector('.stars-display');
        if (starsEl) {
          const fullStars = Math.floor(avgRating);
          const hasHalf = avgRating % 1 >= 0.5;
          starsEl.innerHTML = '★'.repeat(fullStars) + (hasHalf ? '☆' : '') + '☆'.repeat(5 - fullStars - (hasHalf ? 1 : 0));
        }
      }

      displayReviews(reviews) {
        const container = document.querySelector('.recent-reviews');
        if (!container) return;
        
        // Remove existing review items (keep the h3 title)
        const existingItems = container.querySelectorAll('.review-item');
        existingItems.forEach(item => item.remove());
        
        if (!reviews || reviews.length === 0) {
          const emptyMsg = document.createElement('div');
          emptyMsg.className = 'review-item';
          emptyMsg.style.textAlign = 'center';
          emptyMsg.style.padding = '40px 20px';
          emptyMsg.style.color = '#6c757d';
          emptyMsg.innerHTML = '<p>No reviews yet. Be the first to review!</p>';
          container.appendChild(emptyMsg);
          return;
        }
        
        reviews.forEach(review => {
          const reviewEl = document.createElement('div');
          reviewEl.className = 'review-item';
          
          // Handle populated customerId field
          const customer = review.customerId || review.customer || {};
          const reviewerName = customer.name || 'Anonymous';
          const reviewerInitials = reviewerName.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
          const reviewDate = new Date(review.createdAt).toLocaleDateString();
          const timeAgo = this.getTimeAgo(new Date(review.createdAt));
          const stars = '★'.repeat(review.rating || 0) + '☆'.repeat(5 - (review.rating || 0));
          
          reviewEl.innerHTML = `
            <div class="review-header">
              <div class="reviewer-info">
                <div class="reviewer-avatar">${reviewerInitials}</div>
                <div>
                  <div class="reviewer-name">${reviewerName}</div>
                  <div class="review-rating">${stars}</div>
                </div>
              </div>
              <div class="review-date">${timeAgo}</div>
            </div>
            <div class="review-text">${this.escapeHtml(review.comment || '')}</div>
            <div class="review-helpful">
              <span>Was this review helpful?</span>
              <button class="helpful-btn">Yes (0)</button>
              <button class="helpful-btn">No (0)</button>
            </div>
          `;
          
          container.appendChild(reviewEl);
        });
      }

      getTimeAgo(date) {
        const now = new Date();
        const diff = now - date;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        if (days === 0) return 'Today';
        if (days === 1) return 'Yesterday';
        if (days < 7) return `${days} days ago`;
        if (days < 30) return `${Math.floor(days / 7)} weeks ago`;
        if (days < 365) return `${Math.floor(days / 30)} months ago`;
        return `${Math.floor(days / 365)} years ago`;
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      async submitReview() {
        if (!this.workerId) {
          this.showToast('Worker information not found', 'error');
          return;
        }

        const title = document.getElementById('reviewTitle').value.trim();
        const text = document.getElementById('reviewText').value.trim();
        const recommendation = document.querySelector('input[name="recommendation"]:checked');
        const anonymous = document.getElementById('anonymousReview').checked;

        if (this.overallRating === 0) {
          this.showToast('Please provide an overall rating', 'error');
          return;
        }

        if (!text) {
          this.showToast('Please write a review', 'error');
          return;
        }

        if (!recommendation) {
          this.showToast('Please indicate if you would recommend this service', 'error');
          return;
        }

        const submitButton = document.getElementById('submitReview');
        submitButton.classList.add('loading');
        submitButton.disabled = true;

        try {
          // Submit review to API
          const reviewData = {
            workerId: this.workerId,
            rating: this.overallRating,
            comment: text
          };

          const res = await fetch(`${getApiBase()}/reviews`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', ...authHeaders() },
            body: JSON.stringify(reviewData)
          });

          if (!res.ok) {
            const error = await res.json().catch(() => ({ error: 'Failed to submit review' }));
            throw new Error(error.error || 'Failed to submit review');
          }

          const review = await res.json();
          this.showToast('Review submitted successfully!', 'success');
          
          // Reset form
          this.resetForm();
          
          // Reload reviews to show the new one
          await this.loadReviews();

          // Reset button
          submitButton.classList.remove('loading');
          submitButton.disabled = false;

          // Redirect to dashboard after 2 seconds
          setTimeout(() => {
            window.location.href = 'user-dashboard.html';
          }, 2000);

        } catch (error) {
          console.error('Review submission error:', error);
          this.showToast(error.message || 'Failed to submit review', 'error');
          submitButton.classList.remove('loading');
          submitButton.disabled = false;
        }
      }

      resetForm() {
        document.getElementById('reviewTitle').value = '';
        document.getElementById('reviewText').value = '';
        document.querySelectorAll('input[name="recommendation"]').forEach(radio => {
          radio.checked = false;
        });
        document.getElementById('anonymousReview').checked = false;
        
        this.overallRating = 0;
        this.categoryRatings = { quality: 0, punctuality: 0, communication: 0, value: 0 };
        
        // Reset all stars
        document.querySelectorAll('.star').forEach(star => {
          star.classList.remove('active');
        });
      }

      showToast(message, type = 'success') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type} show`;
        
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => {
            toast.textContent = '';
          }, 300);
        }, 3000);
      }
    }

    // Global functions
    window.submitReview = function() {
      if (window.reviewSystem) {
        window.reviewSystem.submitReview();
      }
    };

    // Initialize review system
    document.addEventListener('DOMContentLoaded', () => {
      window.reviewSystem = new ReviewSystem();
    });
  </script>
</body>
</html>
