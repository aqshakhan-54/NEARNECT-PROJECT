<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NearNect Chat - Connect with Service Providers</title>
  <meta name="description" content="Chat with service providers on NearNect - Real-time messaging for seamless communication">
  <meta name="theme-color" content="#6c5ce7">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary: #6c5ce7;
      --secondary: #E91E63;
      --success: #00b894;
      --warning: #fdcb6e;
      --danger: #e17055;
      --info: #74b9ff;
      --dark: #2d3436;
      --light: #ddd6fe;
      --bg: #f8f9fa;
      --text: #2d3436;
      --border: #e9ecef;
      --shadow: 0 4px 6px rgba(0,0,0,0.1);
      --radius: 12px;
      --chat-bg: #ffffff;
      --message-sent: #007bff;
      --message-received: #e9ecef;
      --online: #00b894;
      --offline: #6c757d;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: linear-gradient(135deg, rgba(108,92,231,0.1), rgba(233,30,99,0.1));
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .chat-container {
      width: 100%;
      max-width: 400px;
      height: 600px;
      background: var(--chat-bg);
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    /* Chat Header */
    .chat-header {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      position: relative;
      z-index: 10;
    }

    .profile-picture {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      position: relative;
    }

    .profile-picture img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .online-indicator {
      position: absolute;
      bottom: 2px;
      right: 2px;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      border: 2px solid white;
      background: var(--online);
    }

    .offline-indicator {
      background: var(--offline);
    }

    .chat-info {
      flex: 1;
    }

    .chat-name {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .chat-status {
      font-size: 0.9rem;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--online);
      animation: pulse 2s infinite;
    }

    .status-dot.offline {
      background: var(--offline);
      animation: none;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .chat-actions {
      display: flex;
      gap: 10px;
    }

    .action-btn {
      width: 40px;
      height: 40px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .action-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }

    /* Chat Messages Area */
    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: #f8f9fa;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .chat-messages::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 3px;
    }

    .message {
      display: flex;
      margin-bottom: 10px;
      animation: messageSlide 0.3s ease-out;
    }

    .message.sent {
      justify-content: flex-end;
    }

    .message.received {
      justify-content: flex-start;
    }

    @keyframes messageSlide {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message-bubble {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      position: relative;
      word-wrap: break-word;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .message.sent .message-bubble {
      background: var(--message-sent);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .message.received .message-bubble {
      background: var(--message-received);
      color: var(--text);
      border-bottom-left-radius: 4px;
    }

    .message-text {
      font-size: 0.95rem;
      line-height: 1.4;
      margin-bottom: 5px;
    }

    .message-time {
      font-size: 0.75rem;
      opacity: 0.7;
      text-align: right;
    }

    .message.received .message-time {
      text-align: left;
    }

    .message-status {
      display: flex;
      align-items: center;
      gap: 3px;
      margin-top: 5px;
      justify-content: flex-end;
    }

    .status-icon {
      font-size: 0.7rem;
    }

    .status-icon.sent {
      color: rgba(255,255,255,0.7);
    }

    .status-icon.delivered {
      color: rgba(255,255,255,0.7);
    }

    .status-icon.read {
      color: #4fc3f7;
    }

    /* Typing Indicator */
    .typing-indicator {
      display: none;
      padding: 10px 20px;
      background: white;
      border-top: 1px solid var(--border);
    }

    .typing-indicator.show {
      display: block;
    }

    .typing-content {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #6c757d;
      font-size: 0.9rem;
    }

    .typing-dots {
      display: flex;
      gap: 3px;
    }

    .typing-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #6c757d;
      animation: typingDot 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typingDot {
      0%, 80%, 100% {
        transform: scale(0);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Chat Input Area */
    .chat-input-area {
      background: white;
      padding: 20px;
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .message-input {
      flex: 1;
      padding: 12px 16px;
      border: 2px solid var(--border);
      border-radius: 25px;
      font-size: 0.95rem;
      outline: none;
      transition: all 0.3s ease;
      resize: none;
      max-height: 100px;
      min-height: 44px;
    }

    .message-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(108,92,231,0.1);
    }

    .message-input::placeholder {
      color: #6c757d;
    }

    .send-button {
      width: 44px;
      height: 44px;
      border: none;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .send-button:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 15px rgba(108,92,231,0.4);
    }

    .send-button:active {
      transform: scale(0.95);
    }

    .send-button i {
      font-size: 1.1rem;
      transition: transform 0.3s ease;
    }

    .send-button:hover i {
      transform: translateX(2px);
    }

    .send-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Attachment Button */
    .attachment-button {
      width: 44px;
      height: 44px;
      border: 2px solid var(--border);
      background: white;
      color: #6c757d;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .attachment-button:hover {
      border-color: var(--primary);
      color: var(--primary);
      transform: scale(1.1);
    }

    /* Welcome Message */
    .welcome-message {
      text-align: center;
      padding: 40px 20px;
      color: #6c757d;
    }

    .welcome-icon {
      font-size: 3rem;
      margin-bottom: 15px;
      color: var(--primary);
    }

    .welcome-title {
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text);
    }

    .welcome-text {
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .chat-container {
        height: 100vh;
        max-height: 100vh;
        border-radius: 0;
        max-width: 100%;
      }

      .chat-header {
        padding: 15px;
      }

      .profile-picture {
        width: 45px;
        height: 45px;
        font-size: 1.3rem;
      }

      .chat-name {
        font-size: 1.1rem;
      }

      .chat-messages {
        padding: 15px;
      }

      .chat-input-area {
        padding: 15px;
      }

      .message-bubble {
        max-width: 85%;
      }
    }

    @media (max-width: 480px) {
      .chat-header {
        padding: 12px;
      }

      .chat-messages {
        padding: 12px;
      }

      .chat-input-area {
        padding: 12px;
      }

      .message-input {
        font-size: 16px; /* Prevents zoom on iOS */
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --chat-bg: #1a1a1a;
        --message-received: #2d2d2d;
        --text: #ffffff;
        --border: #333333;
      }

      .chat-messages {
        background: #111111;
      }

      .message-input {
        background: #2d2d2d;
        color: white;
        border-color: #333333;
      }

      .message-input::placeholder {
        color: #888888;
      }
    }

    /* Animation for new messages */
    .message.new {
      animation: newMessage 0.5s ease-out;
    }

    @keyframes newMessage {
      0% {
        opacity: 0;
        transform: translateY(30px) scale(0.8);
      }
      50% {
        opacity: 0.8;
        transform: translateY(-5px) scale(1.05);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Loading state for send button */
    .send-button.loading {
      pointer-events: none;
    }

    .send-button.loading i {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="chat-container">
    <!-- Chat Header -->
    <div class="chat-header">
      <div class="profile-picture">
        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=100&h=100&auto=format&fit=crop" alt="Profile" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
        <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; background: rgba(255,255,255,0.2); border-radius: 50%; font-size: 1.5rem; font-weight: 700;">AK</div>
      </div>
      <div class="online-indicator"></div>
      
      <div class="chat-info">
        <div class="chat-name">Ali Khan - Plumber</div>
        <div class="chat-status">
          <div class="status-dot"></div>
          <span>Online now</span>
        </div>
      </div>
      
      <div class="chat-actions">
        <button class="action-btn" title="Voice Call">
          <i class="fas fa-phone"></i>
        </button>
        <button class="action-btn" title="Video Call">
          <i class="fas fa-video"></i>
        </button>
        <button class="action-btn" title="More Options">
          <i class="fas fa-ellipsis-v"></i>
        </button>
      </div>
    </div>

    <!-- Chat Messages Area -->
    <div class="chat-messages" id="chatMessages">
      <!-- Welcome Message -->
      <div class="welcome-message">
        <div class="welcome-icon">üõ†Ô∏è</div>
        <div class="welcome-title">Welcome to NearNect Chat!</div>
        <div class="welcome-text">You're now connected with Ali Khan, your trusted plumber. Start a conversation to discuss your service needs.</div>
      </div>

      <!-- Sample Messages -->
      <div class="message received">
        <div class="message-bubble">
          <div class="message-text">Hello! I'm Ali Khan, your assigned plumber. I see you need help with plumbing services. How can I assist you today?</div>
          <div class="message-time">10:30 AM</div>
        </div>
      </div>

      <div class="message sent">
        <div class="message-bubble">
          <div class="message-text">Hi Ali! I have a leaky faucet in my kitchen that needs fixing. When can you come over?</div>
          <div class="message-time">10:32 AM</div>
          <div class="message-status">
            <i class="fas fa-check-double status-icon read"></i>
          </div>
        </div>
      </div>

      <div class="message received">
        <div class="message-bubble">
          <div class="message-text">I can come over today afternoon around 2 PM. Is that convenient for you? Also, could you send me a photo of the faucet so I can bring the right tools?</div>
          <div class="message-time">10:33 AM</div>
        </div>
      </div>

      <div class="message sent">
        <div class="message-bubble">
          <div class="message-text">Perfect! 2 PM works great. Let me send you the photo.</div>
          <div class="message-time">10:35 AM</div>
          <div class="message-status">
            <i class="fas fa-check-double status-icon delivered"></i>
          </div>
        </div>
      </div>

      <div class="message received">
        <div class="message-bubble">
          <div class="message-text">Great! I can see the issue from the photo. It looks like a simple washer replacement. I'll bring all the necessary parts. The service will cost ‚Çπ500 including materials and labor. Is that okay?</div>
          <div class="message-time">10:37 AM</div>
        </div>
      </div>

      <div class="message sent">
        <div class="message-bubble">
          <div class="message-text">Yes, that sounds reasonable. See you at 2 PM then!</div>
          <div class="message-time">10:38 AM</div>
          <div class="message-status">
            <i class="fas fa-check-double status-icon read"></i>
          </div>
        </div>
      </div>

      <div class="message received">
        <div class="message-bubble">
          <div class="message-text">Perfect! I'll send you my location when I'm on my way. Thank you for choosing NearNect! üõ†Ô∏è</div>
          <div class="message-time">10:40 AM</div>
        </div>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div class="typing-indicator" id="typingIndicator">
      <div class="typing-content">
        <div class="profile-picture" style="width: 30px; height: 30px; font-size: 0.8rem;">
          <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?q=80&w=50&h=50&auto=format&fit=crop" alt="Profile" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
          <div style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; background: rgba(255,255,255,0.2); border-radius: 50%; font-size: 0.8rem; font-weight: 700;">AK</div>
        </div>
        <span>Ali is typing</span>
        <div class="typing-dots">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </div>
      </div>
    </div>

    <!-- Chat Input Area -->
    <div class="chat-input-area">
      <button class="attachment-button" title="Attach File">
        <i class="fas fa-paperclip"></i>
      </button>
      
      <textarea 
        class="message-input" 
        id="messageInput" 
        placeholder="Type your message here..."
        rows="1"
      ></textarea>
      
      <button class="send-button" id="sendButton" title="Send Message">
        <i class="fas fa-paper-plane"></i>
      </button>
    </div>
  </div>

  <script type="module">
    import { getApiBase, authHeaders, ensureDemoLogin } from './assets/js/api.js';
    class NearNectChat {
      constructor() {
        this.chatMessages = document.getElementById('chatMessages');
        this.messageInput = document.getElementById('messageInput');
        this.sendButton = document.getElementById('sendButton');
        this.typingIndicator = document.getElementById('typingIndicator');
        this.isTyping = false;
        this.typingTimeout = null;
        this.me = null;
        this.peer = null; // recipient
        
        this.init();
      }

      init() {
        this.setupEventListeners();
        this.autoResizeTextarea();
        this.bootstrap();
      }

      async bootstrap() {
        await ensureDemoLogin();
        await this.getMe();
        await this.loadPeer();
        await this.loadMessages();
        await this.initSocket();
        this.scrollToBottom();
      }

      async getMe() {
        try {
          const res = await fetch(`${getApiBase()}/auth/me`, { headers: { ...authHeaders() } });
          if (res.ok) {
            const d = await res.json();
            this.me = d.user;
          }
        } catch (e) {
          console.warn('Failed to fetch current user:', e);
        }
      }

      setupEventListeners() {
        // Send message on button click
        this.sendButton.addEventListener('click', () => {
          this.sendMessage();
        });

        // Send message on Enter key (but allow Shift+Enter for new lines)
        this.messageInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendMessage();
          }
        });

        // Auto-resize textarea
        this.messageInput.addEventListener('input', () => {
          this.autoResizeTextarea();
          this.handleTyping();
        });

        // Attachment button
        document.querySelector('.attachment-button').addEventListener('click', () => {
          this.showAttachmentOptions();
        });

        // Action buttons
        document.querySelectorAll('.action-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            this.handleActionButton(e.target.closest('.action-btn'));
          });
        });
      }

      autoResizeTextarea() {
        const textarea = this.messageInput;
        textarea.style.height = 'auto';
        textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
      }

      async sendMessage() {
        const message = this.messageInput.value.trim();
        if (!message) return;
        if (!this.peer) return;

        // Add loading state
        this.sendButton.classList.add('loading');
        this.sendButton.disabled = true;

        try {
          const res = await fetch(`${getApiBase()}/messages`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', ...authHeaders() },
            body: JSON.stringify({ recipientId: this.peer.id, content: message })
          });
          if (res.ok) {
            const msg = await res.json();
            this.addMessage(message, 'sent', new Date(msg.createdAt).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}));
            this.messageInput.value = '';
            this.autoResizeTextarea();
            this.scrollToBottom();
          }
        } finally {
          this.sendButton.classList.remove('loading');
          this.sendButton.disabled = false;
        }
      }

      addMessage(text, type, timestamp = null) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type} new`;
        
        const time = timestamp || new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        
        let statusHtml = '';
        if (type === 'sent') {
          statusHtml = `
            <div class="message-status">
              <i class="fas fa-check-double status-icon delivered"></i>
            </div>
          `;
        }

        messageDiv.innerHTML = `
          <div class="message-bubble">
            <div class="message-text">${this.escapeHtml(text)}</div>
            <div class="message-time">${time}</div>
            ${statusHtml}
          </div>
        `;

        // Remove welcome message if it exists
        const welcomeMessage = this.chatMessages.querySelector('.welcome-message');
        if (welcomeMessage) {
          welcomeMessage.remove();
        }

        this.chatMessages.appendChild(messageDiv);
        this.scrollToBottom();

        // Remove new class after animation
        setTimeout(() => {
          messageDiv.classList.remove('new');
        }, 500);
      }

      async loadPeer() {
        // For demo, use seeded provider user
        const res = await fetch(`${getApiBase()}/users/demo-provider`, { headers: { ...authHeaders() } });
        if (res.ok) this.peer = await res.json();
      }

      async loadMessages() {
        // Load conversation messages with this.peer
        if (!this.peer) return;
        try {
          const res = await fetch(`${getApiBase()}/messages/user/${this.peer.id}`, { headers: { ...authHeaders() } });
          if (!res.ok) return;
          const data = await res.json();
          this.conversationId = data.conversationId;
          this.chatMessages.innerHTML = '';
          (data.messages || []).forEach(m => {
            const senderId = m.senderId && m.senderId._id ? m.senderId._id : (m.senderId || null);
            const type = (this.me && senderId && senderId.toString() === this.me._id.toString()) ? 'sent' : 'received';
            this.addMessage(m.content, type, new Date(m.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
          });
        } catch (e) {
          console.error('Failed to load messages:', e);
        }
      }

      async initSocket() {
        // Dynamically load socket.io client from API base
        try {
          await new Promise((resolve) => {
            const s = document.createElement('script');
            s.src = `${getApiBase()}/socket.io/socket.io.js`;
            s.onload = resolve;
            s.onerror = resolve;
            document.head.appendChild(s);
          });

          if (!window.io) return;

          const token = (typeof localStorage !== 'undefined') ? localStorage.getItem('nearnect_token') : null;
          this.socket = window.io(getApiBase(), { auth: { token } });

          this.socket.on('connect', () => {
            console.log('chat socket connected');
            if (this.conversationId) this.socket.emit('joinConversation', this.conversationId);
          });

          this.socket.on('connect_error', (err) => {
            console.error('Socket connect error:', err && err.message ? err.message : err);
          });

          this.socket.on('new_message', (msg) => {
            try {
              // Only show if incoming for me
              const myId = this.me ? this.me._id.toString() : null;
              const recipientId = msg.recipientId && msg.recipientId._id ? msg.recipientId._id : (msg.recipientId || null);
              if (recipientId && myId && recipientId.toString() === myId.toString()) {
                // only add if message belongs to current conversation
                if (!this.conversationId || msg.conversationId === this.conversationId) {
                  this.addMessage(msg.content, 'received', new Date(msg.createdAt).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }));
                }
              }
            } catch (e) { console.error(e); }
          });

          this.socket.on('typing', (data) => {
            if (data && data.senderId && this.peer && data.senderId === this.peer.id) {
              this.showTypingIndicator();
              setTimeout(() => this.hideTypingIndicator(), 1500);
            }
          });
        } catch (e) {
          console.warn('Socket init failed:', e);
        }
      }

      showTypingIndicator() {
        this.typingIndicator.classList.add('show');
        this.scrollToBottom();
      }

      hideTypingIndicator() {
        this.typingIndicator.classList.remove('show');
      }

      simulateTyping() {
        // Randomly show typing indicator
        if (Math.random() < 0.3) {
          setTimeout(() => {
            this.showTypingIndicator();
            setTimeout(() => {
              this.hideTypingIndicator();
            }, 2000);
          }, 5000);
        }
      }

      handleTyping() {
        if (!this.isTyping) {
          this.isTyping = true;
          if (this.socket && this.peer) {
            this.socket.emit('typing', { senderId: this.me ? this.me._id : null, recipientId: this.peer.id });
          }
        }

        clearTimeout(this.typingTimeout);
        this.typingTimeout = setTimeout(() => {
          this.isTyping = false;
          if (this.socket && this.peer) {
            this.socket.emit('typing', { senderId: this.me ? this.me._id : null, recipientId: this.peer.id });
          }
        }, 1000);
      }

      scrollToBottom() {
        setTimeout(() => {
          this.chatMessages.scrollTop = this.chatMessages.scrollHeight;
        }, 100);
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }

      showAttachmentOptions() {
        // Simulate attachment options
        const options = ['üì∑ Photo', 'üìÑ Document', 'üìç Location', 'üìû Contact'];
        const randomOption = options[Math.floor(Math.random() * options.length)];
        
        this.addMessage(`[${randomOption} attached]`, 'sent');
        this.messageInput.focus();
      }

      handleActionButton(button) {
        const icon = button.querySelector('i');
        const action = icon.className;
        
        if (action.includes('phone')) {
          this.addMessage('üìû Voice call initiated...', 'sent');
        } else if (action.includes('video')) {
          this.addMessage('üìπ Video call initiated...', 'sent');
        } else if (action.includes('ellipsis-v')) {
          this.addMessage('‚öôÔ∏è More options selected', 'sent');
        }
      }
    }

    // Initialize chat when page loads
    document.addEventListener('DOMContentLoaded', () => { new NearNectChat(); });

    // Add some demo functionality
    window.demoChat = {
      addSampleMessage: (text, type = 'received') => {
        const chat = new NearNectChat();
        chat.addMessage(text, type);
      },
      
      simulateTyping: () => {
        const chat = new NearNectChat();
        chat.showTypingIndicator();
        setTimeout(() => {
          chat.hideTypingIndicator();
          chat.addMessage('This is a demo response!', 'received');
        }, 2000);
      }
    };
  </script>
</body>
</html>
